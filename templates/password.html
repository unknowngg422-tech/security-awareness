{% extends "base.html" %}
{% block title %}<span data-i18n="password_title">ØªÙ‚ÙŠÙŠÙ… ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</span>{% endblock %}

{% block head %}
<style>
  .navbar{display:none!important}

  :root{
    --bg:#0f172a; --card:#0b1220; --text:#e6f0ff; --muted:#94a3b8;
    --border:1px solid rgba(148,163,184,.18);
    --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; --acc:#6366f1; --acc2:#3b82f6;
    --chip:#111827;
  }
  html[data-theme="light"]{
    --bg:#f6fbff; --card:#ffffff; --text:#0f172a; --muted:#6b7280;
    --border:1px solid #e6eef6; --chip:#f3f4f6;
  }
  body{background:var(--bg); color:var(--text)}
  .wrap{max-width:920px;margin:18px auto 48px;padding:0 16px}
  .backbar{display:flex;align-items:center;gap:10px;margin:8px 0 12px;justify-content:center}
  .back{padding:9px 12px;border:var(--border);background:var(--card);border-radius:12px;font-weight:800}
  .theme{padding:9px 12px;border:var(--border);background:var(--card);border-radius:12px;font-weight:800;cursor:pointer}

  .glass{position:relative;border-radius:18px;background:var(--card);padding:18px;border:var(--border);
         box-shadow:0 12px 28px rgba(2,6,23,.22)}
  .title{display:flex;gap:10px;align-items:center;justify-content:center;margin:6px 0 2px}
  .sub{color:var(--muted);text-align:center;margin:0 0 12px}

  .row{display:flex;gap:8px;align-items:center}
  .chip{border:var(--border);background:var(--chip);padding:8px 10px;border-radius:10px;color:var(--text);font-weight:800}
  .btn{padding:10px 12px;border-radius:12px;border:var(--border);background:var(--card);cursor:pointer}
  .btn.primary{color:#fff;border:none;background:linear-gradient(90deg,var(--acc),var(--acc2));box-shadow:0 8px 20px rgba(59,130,246,.28)}
  .btn:disabled{opacity:.55;cursor:not-allowed}

  .field{display:flex;align-items:center;gap:8px;border:var(--border);background:var(--card);border-radius:14px;padding:10px}
  .field input{all:unset;flex:1;padding:8px}
  .icon-btn{width:40px;height:40px;display:grid;place-items:center;border-radius:10px;border:var(--border);background:var(--card);cursor:pointer}

  .bars{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:10px;margin:12px 0}
  .bar{height:8px;border-radius:999px;background:rgba(148,163,184,.22);border:var(--border);overflow:hidden}
  .bar .fill{height:100%;width:0%}
  .bar.ok .fill{background:linear-gradient(90deg,#10b981,#22c55e)}
  .bar.mid .fill{background:linear-gradient(90deg,#f59e0b,#f97316)}
  .bar.bad .fill{background:linear-gradient(90deg,#ef4444,#dc2626)}
  .state{display:flex;align-items:center;gap:10px;justify-content:flex-start}

  .list{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .item{border:var(--border);background:var(--card);padding:10px;border-radius:10px}
  .item.ok{outline:2px solid rgba(34,197,94,.35)}
  .muted{color:var(--muted)}

  .shake{animation:shake .4s ease}
  @keyframes shake{10%,90%{transform:translateX(-1px)} 20%,80%{transform:translateX(2px)}
                   30%,50%,70%{transform:translateX(-4px)} 40%,60%{transform:translateX(4px)}}

  #fx{position:fixed;inset:0;pointer-events:none;z-index:50}
  .container{padding-top:0}
</style>
{% endblock %}

{% block content %}
<canvas id="fx"></canvas>

<div class="wrap">
  <div class="backbar">
    <a class="back" href="{{ url_for('index') }}"><span class="arr">â†©</span> <span data-i18n="nav_home">Ø±Ø¬ÙˆØ¹</span></a>
    <button id="page-theme" class="theme" type="button" data-i18n="quiz_theme">ğŸŒ™ ÙˆØ¶Ø¹ Ø¯Ø§ÙƒÙ†</button>
  </div>

  <div class="glass">
    <div class="title"><div style="font-size:26px">ğŸ”</div><h2 data-i18n="password_title" style="margin:0">ØªÙ‚ÙŠÙŠÙ… Ù‚ÙˆÙ‘Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h2></div>
    <p class="sub" data-i18n="password_subtitle">Ø§ÙƒØªØ¨ÙŠ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± ÙˆØ´Ø§Ù‡Ø¯ÙŠ Ø§Ù„Ù‚ÙˆØ©ØŒ Ø²Ù…Ù† Ø§Ù„ÙƒØ³Ø± ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª.</p>

    <div class="field" id="pwBox">
      <button id="gen" class="icon-btn" title="ØªÙˆÙ„ÙŠØ¯" data-i18n="password_gen">âš¡ ØªÙˆÙ„ÙŠØ¯</button>
      <input id="pw" type="password" placeholder="Ø£Ø¯Ø®Ù„ÙŠ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="new-password" data-i18n-placeholder="password_input">
      <button id="eye" class="icon-btn" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡" data-i18n="password_eye">ğŸ‘ï¸ Ø¥Ø¸Ù‡Ø§Ø±</button>
    </div>
    <div class="muted" style="margin:6px 2px" data-i18n="password_hint">ØªÙ„Ù…ÙŠØ­: ÙƒÙ„Ù…Ø© Ø·ÙˆÙŠÙ„Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù…Ø¹ Ø±Ù…ÙˆØ² Ø£ÙØ¶Ù„ Ø¨ÙƒØ«ÙŠØ± Ù…Ù† ÙƒÙ„Ù…Ø© Ù‚ØµÙŠØ±Ø© Â«Ø°ÙƒÙŠØ©Â».</div>

    <div class="bars">
      <div class="bar" id="b1"><div class="fill"></div></div>
      <div class="bar" id="b2"><div class="fill"></div></div>
      <div class="bar" id="b3"><div class="fill"></div></div>
      <div class="bar" id="b4"><div class="fill"></div></div>
    </div>

    <div class="state">
      <span class="chip" id="status">â€”</span>
      <span class="chip" id="crack">â± â€”</span>
      <span class="chip" id="method">ğŸ› ï¸ â€”</span>
      <span class="chip" id="score">ğŸ”¢ 0/4</span>
    </div>

    <div class="list" style="margin-top:12px">
      <div class="item" id="c-len" data-i18n="password_len">Ø·ÙˆÙ„ â‰¥ 12</div>
      <div class="item" id="c-up" data-i18n="password_up">Ø­Ø±ÙˆÙ ÙƒØ¨ÙŠØ±Ø© (A-Z)</div>
      <div class="item" id="c-low" data-i18n="password_low">Ø­Ø±ÙˆÙ ØµØºÙŠØ±Ø© (a-z)</div>
      <div class="item" id="c-num" data-i18n="password_num">Ø£Ø±Ù‚Ø§Ù… (0-9)</div>
      <div class="item" id="c-sym" data-i18n="password_sym">Ø±Ù…ÙˆØ² (!@#â€¦)</div>
      <div class="item" id="c-pwn" data-i18n="password_pwn">ØºÙŠØ± Ù…Ø³Ø±Ù‘Ø¨Ø©</div>
    </div>

    <div class="muted" id="tips" style="margin-top:10px"></div>

    <div class="row" style="justify-content:flex-end;margin-top:12px">
      <button id="apply" class="btn primary" disabled data-i18n="password_apply">Ø§Ø¹ØªÙ…Ø§Ø¯</button>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<!-- ğŸ”„ Ø²Ø± ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© -->
<script>
(function(){
  const LANG_KEY = 'site_lang';
  const btn = document.createElement('button');
  btn.id = 'lang-toggle';
  btn.style.position = 'fixed';
  btn.style.top = '12px';
  btn.style.left = '12px';
  btn.style.zIndex = '9999';
  btn.style.padding = '6px 10px';
  btn.style.borderRadius = '8px';
  btn.style.border = '1px solid rgba(255,255,255,.2)';
  btn.style.background = 'var(--card)';
  btn.style.color = 'var(--text)';
  btn.style.cursor = 'pointer';
  btn.style.fontWeight = '600';
  document.body.appendChild(btn);

  async function loadLang(lang){
    try{
      const res = await fetch(`/static/lang/${lang}.json`);
      const dict = await res.json();
      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const key = el.getAttribute('data-i18n');
        if(dict[key]) el.textContent = dict[key];
      });
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el=>{
        const key = el.getAttribute('data-i18n-placeholder');
        if(dict[key]) el.setAttribute('placeholder', dict[key]);
      });
      localStorage.setItem(LANG_KEY,lang);
      document.documentElement.lang = lang;
      document.documentElement.dir = lang==='ar'?'rtl':'ltr';
      btn.textContent = lang==='ar'?'English ğŸŒ':'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ğŸŒ';
    }catch(e){console.error('lang load error',e);}
  }

  btn.addEventListener('click',()=>{
    const current = localStorage.getItem(LANG_KEY)||'ar';
    const next = current==='ar'?'en':'ar';
    loadLang(next);
    location.reload();
  });

  const saved = localStorage.getItem(LANG_KEY)||'ar';
  loadLang(saved);
})();
</script>

<!-- âš™ï¸ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø£ØµÙ„ÙŠ -->
<script>
(function(){
  const pw=document.getElementById('pw'),eye=document.getElementById('eye'),gen=document.getElementById('gen'),
        box=document.getElementById('pwBox'),b=[...['b1','b2','b3','b4'].map(id=>document.getElementById(id))],
        status=document.getElementById('status'),crack=document.getElementById('crack'),
        method=document.getElementById('method'),scoreChip=document.getElementById('score');
  const checks={len:document.getElementById('c-len'),up:document.getElementById('c-up'),low:document.getElementById('c-low'),
                num:document.getElementById('c-num'),sym:document.getElementById('c-sym'),pwn:document.getElementById('c-pwn')};
  const tips=document.getElementById('tips'),applyBtn=document.getElementById('apply');
  const fx=document.getElementById('fx'),ctx=fx.getContext('2d');let W=0,H=0,bits=[];
  function resize(){W=fx.width=innerWidth;H=fx.height=innerHeight;}
  function confetti(){for(let i=0;i<180;i++){bits.push({x:Math.random()*W,y:-10-Math.random()*H*.2,v:1+Math.random()*2,s:4+Math.random()*6,a:Math.random()*6,h:180+Math.random()*160});}}
  function step(){ctx.clearRect(0,0,W,H);bits=bits.filter(p=>p.y<H+12);for(const p of bits){p.y+=p.v*2.2;p.x+=Math.sin(p.a+=.06)*1.6;ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.a);ctx.fillStyle=`hsl(${p.h},70%,55%)`;ctx.fillRect(-p.s/2,-p.s/2,p.s,p.s);ctx.restore();}requestAnimationFrame(step);}
  addEventListener('resize',resize);resize();step();

  function localChecks(v){checks.len.classList.toggle('ok',v.length>=12);checks.up.classList.toggle('ok',/[A-Z]/.test(v));
    checks.low.classList.toggle('ok',/[a-z]/.test(v));checks.num.classList.toggle('ok',/\d/.test(v));checks.sym.classList.toggle('ok',/[^A-Za-z0-9]/.test(v));}
  function bars(score){const s=['bad','bad','mid','ok','ok'];b.forEach((el,i)=>{el.className='bar '+(i<score?s[score]:''),el.querySelector('.fill').style.width=i<score?'100%':'0%';});}
  function ui(score,crk,met,fb,pwn){const lang=localStorage.getItem('site_lang')||'ar';
    const map={ar:['Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ù‹Ø§','Ø¶Ø¹ÙŠÙØ©','Ù…ØªÙˆØ³Ø·Ø©','Ø¬ÙŠØ¯Ø©','Ù‚ÙˆÙŠØ©'],en:['Very Weak','Weak','Medium','Good','Strong']}[lang];
    const hue=['var(--bad)','var(--bad)','var(--warn)','var(--ok)','var(--ok)'][score||0];
    status.style.borderColor=hue;status.textContent=map[Math.max(0,Math.min(4,score||0))];
    crack.textContent='â± '+(crk||'â€”');method.textContent='ğŸ› ï¸ '+(met||'â€”');
    scoreChip.textContent='ğŸ”¢ '+(score||0)+'/4';checks.pwn.classList.toggle('ok',!(pwn&&pwn.found));
    tips.textContent=(fb?.warning?fb.warning+' â€” ':'')+(fb?.suggestions||[]).join(lang==='ar'?'ØŒ ':', ');
    bars(score||0);applyBtn.disabled=!((score||0)>=3&&!(pwn&&pwn.found));}
  async function scoreIt(v){if(!v){ui(0,'â€”','â€”',{suggestions:[]},{found:false});bars(0);return;}
    const r=await fetch("{{ url_for('api_password_score') }}",{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({password:v})});return await r.json();}
  pw.addEventListener('input',async()=>{const v=pw.value||'';localChecks(v);if(!v){ui(0,'â€”','â€”',{suggestions:[]},{found:false});return;}
    try{const data=await scoreIt(v);ui(data.score,data.crack_time_display,data.crack_method,data.feedback,data.pwned);
      if((data.score||0)<=1){box.classList.add('shake');}if((data.score||0)===4){confetti();}}
    catch(e){const lang=localStorage.getItem('site_lang')||'ar';ui(0,'â€”','â€”',{warning:lang==='ar'?'ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…':'Failed to connect to server',suggestions:[]},{found:false});box.classList.add('shake');}});
  gen.addEventListener('click',()=>{const a='ABCDEFGHJKLMNPQRSTUVWXYZ',b='abcdefghijkmnopqrstuvwxyz',d='23456789',s='!@#$%^&*()-_=+[]{}:.?';let o='';function p(str,n){for(let i=0;i<n;i++)o+=str[Math.floor(Math.random()*str.length)];}p(a,3);p(b,5);p(d,3);p(s,3);pw.value=o.split('').sort(()=>Math.random()-.5).join('');pw.dispatchEvent(new Event('input'));});
  eye.addEventListener('click',()=>{pw.type=pw.type==='password'?'text':'password';});
  applyBtn.addEventListener('click',()=>{const lang=localStorage.getItem('site_lang')||'ar';applyBtn.textContent=lang==='ar'?'ØªÙ… âœ…':'Done âœ…';setTimeout(()=>applyBtn.textContent=lang==='ar'?'Ø§Ø¹ØªÙ…Ø§Ø¯':'Apply',1500);});
  pw.dispatchEvent(new Event('input'));
})();
</script>
{% endblock %}
